<mat-expansion-panel>
  <mat-expansion-panel-header>
    <mat-panel-title>{{ weapon.uniquename }}</mat-panel-title>
  </mat-expansion-panel-header>

  <mat-card-content>
    <div class="header">
      <app-icon [itemName]="weapon.uniquename"></app-icon>
      <div class="name">{{ weapon.uniquename }}</div>
    </div>

    @for (flatCraft of weapon.craftingrequirements; track flatCraft; let i = $index) {
      <div class="craft-row">
        <div class="craft-section">
          <app-recipe [craftingrequirement]="flatCraft"
                      [totalResourcesCostSignal]="totalResourcePrice[i]"></app-recipe>
        </div>

        <div class="prices-section">
          <app-item-price-display
            [displayType]="PriceType.SellMin"
            [prices]="apiWeaponPrices.get(weapon.uniquename) || []"
            [selectedPricesPerQualitySignals]="selectedPricesSignalMap.get(0)!">
          </app-item-price-display>
        </div>

        <div class="selected-prices-section">
          @for (baseEnchantPrices of selectedPricesSignalMap.get(0); track baseEnchantPrices; let qualityIndex = $index) {
            <app-input [value]="selectedPricesSignalMap.get(0)![qualityIndex]()" class="quality-input"/>
          }
        </div>

        <div class="profit-section">
          @for (quality of selectedPricesSignalMap.get(0)!; track $index; let qualityIndex = $index) {
            <app-input [displayOnly]="true" [value]="getProfit(0, qualityIndex)" class="profit-input"/>
          }
        </div>

        <div class="profit-percentage-section">
          @for (quality of selectedPricesSignalMap.get(0)!; track $index; let qualityIndex = $index) {
            <app-input [displayOnly]="true" [value]="getProfitPercentage(0, qualityIndex)" class="percentage-input"/>
          }
        </div>
      </div>
    }

    @for (enchantCraft of weapon.enchantments?.enchantment; track enchantCraft.enchantmentlevel) {
      <app-separator></app-separator>
      <div class="craft-row">
        <div class="craft-section">
          <app-enchant-recipe [enchant]="enchantCraft"
                              [totalResourcesCostSignal]="totalResourcePrice[parseInt(enchantCraft.enchantmentlevel)]"></app-enchant-recipe>
        </div>

        <div class="prices-section">
          <app-item-price-display
            [displayType]="PriceType.SellMin"
            [prices]="apiWeaponPrices.get(weapon.uniquename + '@' + enchantCraft.enchantmentlevel) || []"
            [selectedPricesPerQualitySignals]="selectedPricesSignalMap.get(parseInt(enchantCraft.enchantmentlevel))!">
          </app-item-price-display>
        </div>

        <div class="selected-prices-section">
          @for (signal of selectedPricesSignalMap.get(parseInt(enchantCraft.enchantmentlevel))!; track $index; let qualityIndex = $index) {
            <app-input [value]="signal()" class="quality-input"/>
          }
        </div>

        <div class="profit-section">
          @for (quality of selectedPricesSignalMap.get(parseInt(enchantCraft.enchantmentlevel))!; track $index; let qualityIndex = $index) {
            <app-input [displayOnly]="true" [value]="getProfit(parseInt(enchantCraft.enchantmentlevel), qualityIndex)" class="profit-input"/>
          }
        </div>

        <div class="profit-percentage-section">
          @for (quality of selectedPricesSignalMap.get(parseInt(enchantCraft.enchantmentlevel))!; track $index; let qualityIndex = $index) {
            <app-input [displayOnly]="true"
                       [value]="getProfitPercentage(parseInt(enchantCraft.enchantmentlevel), qualityIndex)" class="percentage-input"/>
          }
        </div>
      </div>
    }
  </mat-card-content>
</mat-expansion-panel>
